<div class="container mt-4">
  <h2 class="mb-3 text-principal">ðŸ“¦ Distributeurs & Produits</h2>

  <!-- <div class="card mb-4 shadow-sm">
    @for (distributeur of distributeurs; track $index) {
         <div class="card-header background info-principal d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">{{ distributeur.nom }}</h5>
              <small class="text-secondary">ðŸ“ž {{ distributeur.telephone || 'N/A' }}</small>
            </div>
    </div>
    <div class="card-body p-3">
        @if (distributeur.produits.length > 0) {
           <div class="table-responsive">
          <table class="table table-hover table-sm align-middle mb-0">
            <thead class="background secondary ">
              <tr>
                <th>Produit</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              @if (distributeur.produits && distributeur.produits.length > 0) {
                @for (produit of distributeur.produits; track produit.id) {
                  <td>{{ produit.nom }}</td>
                  <td>{{ produit.description || 'â€”' }}</td>
                }
              }
              @else {
                <tr>
                  <td colspan="2" class="text-center text-secondary">Aucun produit disponible</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
        }
        @else {
            <tr>
               <td colspan="2" class="text-center text-secondary">Aucun produit disponible</td>
            </tr>
        }

      </div>

     }

           <div class="d-flex justify-content-end">
        <div class="form-group mr-3">
          <label for="itemsPerPage">Ã‰lÃ©ments par page :</label>
          <select class="form-control" id="itemsPerPage" [(ngModel)]="itemsPerPage">
            <option *ngFor="let option of [10, 20, 30, 40, 50]" [value]="option">{{ option }}</option>
          </select>
        </div>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-secondary" (click)="previousPage()" [disabled]="currentPage === 1">
            PrÃ©cÃ©dent
          </button>
          <button type="button" class="btn btn-secondary" (click)="nextPage()" [disabled]="currentPage === totalPages">
            Suivant
          </button>
        </div>
      </div>
    -->


  <!-- <app-list
  [data]="distributeurs"
  [columns]="[
    { key: 'nom', label: 'Nom' },
    { key: 'telephone', label: 'TÃ©lÃ©phone' }
  ]"
  (edit)="modifier($event)"
  (delete)="supprimer($event)">
</app-list> -->


<div class="container text-center mb-3">
    <div class="row">
        <div class="col">

            <button type="button" class="btn btn-primary rounded-pill m-1 p-1" data-bs-toggle="modal"  data-bs-target="#createDistributeur" (click)="openCreateModal()">
                + Add
            </button>
        </div>
    </div>
    <div class="row text-start gap-1">
        @if (loading) {loading...}@else {@if (distributeurs && distributeurs.length > 0) {

        <div class="accordion" id="accordionUsers">
            @for (dist of distributeurs; track $index) {
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + $index" aria-expanded="false" aria-controls="collapse">
                        <div class="d-flex align-items-center justify-content-between">
                            <h2> {{dist.nom}}</h2>
                            <div>
                                <button type="button" class="btn btn-sm btn-warning mr-2" data-bs-toggle="modal"  data-bs-target="#createDistributeur" (click)="openEditModal(dist)">Modifier</button>
                                <button class="btn btn-sm btn-danger" >Supprimer</button>
                            </div>
                        </div>
                    </button>
                </h2>
                <div [attr.id]="'collapse' + $index" class="accordion-collapse collapse">
                    <div class="m-2">
                        Contact:
                        <span class="text-secondary">{{dist.telephone}}, {{dist.adress}}</span>
                    </div>
                    <div class="m-2">
                        <h5>Produits</h5>
                        <app-list
                        [data]="dist.produits"
                        [columns]="[
                           { key: 'nom', label: 'Nom' },
                           { key: 'description', label: 'Description' }
                        ]"
                        (edit)="modifier($event)"
                        (delete)="supprimer($event)"> </app-list>

                        <button type="button" class="btn btn-warning rounded-pill m-1 p-1" data-bs-toggle="modal" [attr.data-bs-target]="'#createProduct' + $index">
                            + add
                        </button>
                    </div>
                </div>
            </div>
            <!-- Modal product-->
            <div class="modal fade" [attr.id]="'createProduct' + $index" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Create Product</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form [formGroup]="productForm" (ngSubmit)="submitAllProducts(dist.id)">
  <div formArrayName="products">
    @for (productGroup of products.controls; track $index ) {
         <div

      [formGroupName]="$index"
      class="border rounded p-3 mb-2"
    >
      <h6>Produit {{ $index + 1 }}</h6>

      <div class="mb-2">
        <input
          type="text"
          class="form-control"
          formControlName="name"
          placeholder="Nom du produit"
          required
        />
      </div>

      <div class="mb-2">
        <input
          type="text"
          class="form-control"
          formControlName="description"
          placeholder="Description"
          required
        />
      </div>
    </div>
    }

  </div>

  <div class="d-flex justify-content-between mt-3">
    <button type="button" class="btn btn-outline-primary" (click)="addProduct()">
      âž• CrÃ©er un autre produit
    </button>

     <button type="button" class="btn btn-outline-danger" (click)="deleteProduct($index)">
      Supprimer une ligne
    </button>
    <button type="submit" class="btn btn-success" [disabled]="products.length === 0">
      ðŸŸ¢ CrÃ©er
    </button>
  </div>
</form>

                          </div>
                    </div>
                </div>
            </div>
            <!-- fin modal -->
            }
        </div> }@else {
        <div class="container">
            <div class="row justify-content-center">
                <!-- <img src="assets/icons/openbox.png" alt="openbox" width="30 px" height="auto"> -->
                <h3 class="text-center">Page vide</h3>
                <p class="text-center">
                    Creez un distributeur en cliquant sur le bouton "+add"
                </p>
            </div>
        </div>} }
    </div>
</div>
<!-- Modal create -->
<!-- <div class="modal fade" id="createDistributeur" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Create Distributeur</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="needs-validation" [formGroup]="distributeurForm" (ngSubmit)="createDistributeur()" novalidate>
                    <div class="ms-auto me-auto mb-2">
                        <label for="nameDistributeur" class="visually-hidden">Name</label>
                        <input type="text" class="form-control" formControlName="name" name="nameDistributeur" id="nameDistributeur" placeholder="name distributeur" required>
                    </div>
                    <div class="ms-auto me-auto mb-2">
                        <label for="adress" class="visually-hidden">Adress</label>
                        <input type="text" class="form-control" formControlName="adress" name="adress" id="adress" placeholder="Adress" required>
                    </div>
                    <div class="ms-auto me-auto mb-2 ">
                        <label for="tel" class="visually-hidden">Tel</label>
                        <input type="text" class="form-control" formControlName="tel" name="tel" id="tel" placeholder="Tel" required>
                    </div>
                    <div class="ms-auto me-auto mb-2 mt-3">
                        <button type="submit" class="btn btn-primary p-1 m-1" [disabled]="!distributeurForm.valid">
                            <span class="ms-5 me-5 ">Create</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div> -->
<div class="modal fade" id="createDistributeur" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          {{ isEditMode ? 'Modifier Distributeur' : 'CrÃ©er Distributeur' }}
        </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        <form class="needs-validation" [formGroup]="distributeurForm" (ngSubmit)="onSubmit()" novalidate>
          <div class="mb-2">
            <label for="nameDistributeur" class="visually-hidden">Nom</label>
            <input type="text" class="form-control" formControlName="name" id="nameDistributeur" placeholder="Nom distributeur" required>
          </div>
          <div class="mb-2">
            <label for="adress" class="visually-hidden">Adresse</label>
            <input type="text" class="form-control" formControlName="adress" id="adress" placeholder="Adresse" required>
          </div>
          <div class="mb-2">
            <label for="tel" class="visually-hidden">TÃ©lÃ©phone</label>
            <input type="text" class="form-control" formControlName="tel" id="tel" placeholder="TÃ©lÃ©phone" required>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-primary w-100" [disabled]="!distributeurForm.valid">
              {{ isEditMode ? 'Mettre Ã  jour' : 'CrÃ©er' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

 </div>
